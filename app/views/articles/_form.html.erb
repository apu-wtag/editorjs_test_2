<%= form_with(model: article, class: "max-w-3xl mx-auto px-4 space-y-12", data: { controller: "editor" }) do |form| %>
  <% if article.errors.any? %>
    <div class="rounded-md bg-red-50 p-5 text-sm text-red-700 shadow-sm">
      <h2 class="font-semibold">
        <%= pluralize(article.errors.count, "error") %> prohibited this article from being saved:
      </h2>
      <ul class="mt-2 list-disc pl-5 space-y-1">
        <% article.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <!-- Title -->
  <div class="pb-6 border-b border-gray-200">
    <%= form.text_field :title,
                        placeholder: "Title",
                        class: "w-full text-5xl sm:text-6xl font-bold text-gray-900 placeholder-gray-400 border-0 focus:ring-0 focus:outline-none",
                        autofocus: true,
                        id: "article_title" %>
  </div>

  <!-- Topic -->
  <div class="pb-6 border-b border-gray-200 relative" data-controller="autocomplete">
    <%= form.text_field :topic_name,
                        placeholder: "Type to search or create a new topic...",
                        autocomplete: "off",
                        id: "article_topic_name",
                        class: "w-full text-lg font-medium text-gray-700 placeholder-gray-400 border-0 focus:ring-0 focus:outline-none",
                        data: {
                          autocomplete_target: "input",
                          action: "input->autocomplete#filter"
                        } %>

    <!-- Autocomplete results -->
    <div class="hidden absolute z-10 mt-2 w-full max-h-60 overflow-y-auto rounded-lg bg-white shadow-lg ring-1 ring-black/5"
         data-autocomplete-target="results"
         data-action="click->autocomplete#preventHide">
      <% Topic.all.each do |topic| %>
        <div class="cursor-pointer px-4 py-2 text-gray-800 hover:bg-gray-100"
             data-autocomplete-target="option"
             data-action="click->autocomplete#select">
          <%= topic.name %>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Content -->
  <div class="pb-6 border-b border-gray-200">
    <%= form.hidden_field :content, id: "article_content_hidden" %>
    <div id="article_content"
         data-editor-target="article_content"
         class="prose lg:prose-xl max-w-none min-h-[400px] text-gray-800 focus:outline-none">
    </div>
  </div>

  <!-- Actions -->
  <div class="flex items-center gap-4 pt-4">
    <%= form.submit "Publish",
                    class: "px-6 py-2.5 rounded-full bg-blue-600 hover:bg-blue-500 text-white font-semibold transition" %>

    <% if article.persisted? %>
      <%= link_to "Show this article", article, class: "px-5 py-2.5 rounded-full bg-gray-100 hover:bg-gray-200 text-gray-800 transition" %>
    <% end %>

    <%= link_to "Back to articles", articles_path, class: "px-5 py-2.5 rounded-full bg-gray-100 hover:bg-gray-200 text-gray-800 transition" %>
  </div>
<% end %>
